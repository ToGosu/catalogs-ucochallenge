# ModSecurity Configuration
# Modo de detección (no bloquea, solo registra)
SecRuleEngine DetectionOnly

# Directorio de trabajo
SecWorkDir /var/log/nginx/modsec/
SecTmpDir /var/log/nginx/modsec/tmp/

# Configuración de request body
SecRequestBodyAccess On
SecRequestBodyLimit 13107200
SecRequestBodyNoFilesLimit 131072
SecRequestBodyLimitAction Reject

# Configuración de response body
SecResponseBodyAccess On
SecResponseBodyMimeType text/plain text/html text/xml
SecResponseBodyLimit 524288

# Reglas básicas de seguridad
SecDefaultAction "phase:1,log,auditlog,pass"
SecDefaultAction "phase:2,log,auditlog,pass"

# Reglas personalizadas - SQL Injection
SecRule ARGS "@detectSQLi" \
    "id:1000,\
    phase:2,\
    log,\
    msg:'SQL Injection Attack Detected',\
    severity:'CRITICAL'"

# Reglas personalizadas - XSS
SecRule ARGS "@detectXSS" \
    "id:1001,\
    phase:2,\
    log,\
    msg:'XSS Attack Detected',\
    severity:'CRITICAL'"

# Deshabilitar reglas para rutas específicas si es necesario
# SecRule REQUEST_URI "@beginsWith /catalog/actuator/" \
#     "id:1002,\
#     phase:1,\
#     nolog,\
#     pass,\
#     ctl:ruleEngine=Off"

